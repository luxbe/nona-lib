# Nona ðŸ‘µ

// TODO: Review introduction  
Typescript client to interact with your Nano node.
This client simplifies the complexities involved in communicating with a Nano node, providing streamlined processes for sending and receiving transactions, retrieving wallet, managing websockets and more.
Start integrating Nano transactions into your applications seamlessly with our easy-to-use Typescript client.

## Table of Contents

// TODO: Set the table of contents

## Installation

// TODO: Review the installation instructions
`npm install @nona/nona`

// TODO: Mention information about RPC enable_control

## Getting Started

// TODO: Create getting started guide

```typescript

```

## Basic Usage

### Create an account

You can simply create a new account with the following code:

```typescript
const { privateKey, publicKey, address } = await nona.key.create();
```

Or from a seed :

```typescript
// Use KeyService to generate a seed or provide your own
const seed = await KeyService.generateSeed();
const { privateKey, publicKey, address } = await nona.key.create(seed);
```

These keys are securely generated locally using the [nanocurrency-js](https://github.com/marvinroger/nanocurrency-js/tree/master/packages/nanocurrency) package.

### Open an account

Before using an account, you need to open it.  
To open an account, you must have sent some funds to it from another account (see [Send a transaction](#send-a-transaction) to send some funds from an opened account).

Then call the open method:

```typescript
// You must provide a representative address to open the account
const reprensentative = 'nano_3rep...';

const wallet = await nona.wallet(privateKey);
await wallet.open(reprensentative);
```

If you don't know how to choose a representative, check out this blog post: [How to choose a representative](https://nano.org/en/blog/how-to-choose-your-nano-representative--74f4c8c4).

### Send a transaction

To send a transaction, you must have an opened account (see [Open an account](#open-an-account)).

```typescript
const receveiver = 'nano_1rece...';
const amount = 2;

const wallet = await nona.wallet(privateKey);
await wallet.send(receveiver, amount);
```

### Receive a transaction

To receive a transaction, you must have an opened account (see [Open an account](#open-an-account)).

To receive a single transaction:

```typescript
const wallet = await nona.wallet(privateKey);
await wallet.receive();
```

If you want to receive all pending transactions:

```typescript
const wallet = await nona.wallet(privateKey);
await wallet.receiveAll();
```

You can also use the websocket to listen and receive transactions in real time:

```typescript
const wallet = await nona.wallet(privateKey);
// Will create a websocket connection, listen for incoming transactions and automatically receives them.
const subscription = await wallet.listenAndReceive({
  // (Optional) next will be called each time a transaction is received
  next: (transactionBlock) => console.log('Received transaction', transactionBlock),
});

// Don't forget to unsubscribe when you don't need it anymore
subscription.unsubscribe();
```

// TODO: Set websocket documentation  
More information about websocket, see [Websocket](#websocket).

## Nona API

### Wallet

> [!WARNING]  
> This wallet API does not interact with the [wallet RPCs commands](https://docs.nano.org/commands/rpc-protocol/#wallet-rpcs) this naming is only for convenience.

The wallet is the main object to interact with your account.

```typescript
const wallet = await nona.wallet(privateKey);
```

#### Open

`open(representative: string): Promise<string>`

Opens the account with the provided representative.
The first transaction of an account is crafted in a slightly different way. To open an account, you must have sent some funds to it with from another account.
Returns the hash of the transaction.

```typescript
const representative = 'nano_3rep...';
await wallet.open(representative);
```

#### Send

`send(address: string, amount: number | string): Promise<string>`

Sends a transaction to the specified address.  
The amount is in nano unit.  
Returns the hash of the transaction.

```typescript
const address = 'nano_1rece...';
const amount = 2;

await wallet.send(address, amount);
```

> [!NOTE]  
> The work is generated by the node, the options to provide or generate the work locally are not yet implemented.

#### Receive

`receive(hash?: string): Promise<string>`

Receives a pending transaction.  
The hash of the transaction to receive can be provided. If not, a receivable hash will be used.  
Returns the hash of the transaction.

```typescript
await wallet.receive();
```

#### Receive all

`receiveAll(): Promise<string[]>`

Receives all pending transactions.  
Returns an array of hashes of the received blocks.

```typescript
await wallet.receiveAll();
```

#### Receive multiple transactions

`receiveMultipleTransactions(hashes: string[]): Promise<string[]>`

Receives multiple pending transactions.
From an array of hashes of the transactions to receive.
Returns an array of hashes of the received blocks.

```typescript
const hashes = ['D83124BB...', '1208FF64...'];
await wallet.receiveMultipleTransactions(hashes);
```

#### Listen and receive

> [!NOTE]  
> All the webscoket related methods use Rxjs Observables and return a Subscription object. For more information about observables and subscriptions, see the [Rxjs documentation](https://rxjs.dev/).

`listenAndReceive(params?: WalletListAndReceiveParams): Subscription`

Listens for incoming transactions and automatically receives them.  
Return a [Subscription](https://rxjs.dev/guide/subscription) object.

```typescript
export interface WalletListAndReceiveParams {
  /**
   * A function that will be called each time a transaction is received.
   * @param block The block that was received.
   */
  next?: (block: ConfirmationBlock) => unknown;
  /**
   * A function that will be called when an error occurs.
   * @param error The error that occurred.
   */
  error?: (error: unknown) => unknown;
  /**
   * A function that will be called when the listener completes.
   */
  complete?: () => unknown;
}
```

```typescript
const subscription = await wallet.listenAndReceive({
  next: (transactionBlock) => console.log('Received transaction', transactionBlock),
  error: (error) => console.error('An error occurred', error),
  complete: () => console.log('Subscription completed'),
});

// Don't forget to unsubscribe when you don't need it anymore
subscription.unsubscribe();
```

## TODO

- [ ] Change options to params in params methods
- [ ] Handle errors
  - [ ] Handle connection errors
  - [ ] Handle format errors
  - [ ] Handle response errors from the node
- [ ] Websocket support
- [ ] Work server options
- [ ] Check integration with nano.to
- [ ] Tests

```

```
